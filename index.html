import React, { useEffect, useMemo, useRef, useState } from "react";
import { motion, useMotionValue, useTransform } from "framer-motion";
import { Download, Mail, Github, Linkedin, Terminal as TerminalIcon, ChevronRight } from "lucide-react";

// single‑file React app for a minimal, modern, animated CV site with a looping terminal
// drop a photo named "sirish.jpeg" (or sirish.jpg as fallback) in the public folder
// and place your pdf resume at: 
//   public/"Sirish-Yadav-Network and Systems Administrator.pdf"
// this component assumes TailwindCSS is available

const consoleLines = [
  "az group create -n rg-401-prod -l canadacentral",
  "az network vnet create -g rg-401-prod -n vnet-hub --address-prefix 10.130.0.0/16",
  "az network vnet peering create --name hub-spoke --allow-vnet-access",
  "fortictl vpn up --site wawa --ddns starlink.401group.ddns.net",
  "entra groups create --dynamic --unit dealerships --no-drama",
  "intune autopilot enroll --profile 'Standard Workstation' --hash @devices.csv",
  "ssh pbx 'qos --enable && echo call quality: chefs kiss'",
  "printf 'uptime: good\\n' && echo 'alerts: napping'",
];

function useTypeLoop(lines: string[], speed = 26, hold = 800) {
  const [history, setHistory] = useState<string[]>([]);
  const [current, setCurrent] = useState("");
  const [i, setI] = useState(0);
  const [j, setJ] = useState(0);

  useEffect(() => {
    let timer: number;
    const type = () => {
      const line = lines[i % lines.length] ?? "";
      if (j < line.length) {
        setCurrent((prev) => prev + line[j]);
        setJ((v) => v + 1);
        timer = window.setTimeout(type, speed);
      } else {
        // line finished, push to history, wait, then next
        timer = window.setTimeout(() => {
          setHistory((h) => [...h, line]);
          setCurrent("");
          setJ(0);
          setI((v) => v + 1);
        }, hold);
      }
    };
    // if we've printed too many lines, reset with a brief pause
    if (history.length >= lines.length) {
      const t = window.setTimeout(() => {
        setHistory([]);
        setCurrent("");
        setI(0);
        setJ(0);
      }, 1000);
      return () => window.clearTimeout(t);
    }
    timer = window.setTimeout(type, 300);
    return () => window.clearTimeout(timer);
  }, [i, j, lines, speed, hold, history.length]);

  return { history, current };
}

function TerminalLoop() {
  const { history, current } = useTypeLoop(consoleLines, 24, 700);
  return (
    <div className="bg-[#0e1117]/90 border border-white/10 rounded-2xl p-4 md:p-6 font-mono text-[0.96rem] text-zinc-200 shadow-2xl backdrop-blur relative overflow-hidden">
      {/* traffic lights */}
      <div className="absolute left-4 top-3 flex gap-2 text-zinc-500 select-none">
        <span>●</span><span>●</span><span>●</span>
      </div>
      <div className="mt-4 space-y-2">
        {history.map((line, idx) => (
          <div key={idx} className=""> 
            <span className="text-zinc-500">sirish@edge</span> <span className="text-zinc-400">$</span> <span className="text-zinc-100">{line}</span>
            <span className="ml-2 text-emerald-400">✔</span>
          </div>
        ))}
        <div>
          <span className="text-zinc-500">sirish@edge</span> <span className="text-zinc-400">$</span> <span className="text-zinc-100">{current}</span>
          <span className="inline-block w-3 bg-zinc-200/90 ml-0.5 animate-pulse h-[1.15em] align-[-0.15em]" />
        </div>
      </div>
      <div className="pointer-events-none absolute inset-0" style={{
        background: "radial-gradient(1200px 400px at 10% -10%, rgba(124,58,237,.15), transparent 40%), radial-gradient(1000px 300px at 110% 120%, rgba(6,182,212,.16), transparent 40%)"
      }} />
    </div>
  );
}

function Background() {
  return (
    <div aria-hidden className="fixed inset-0 -z-10">
      {/* gradient blobs */}
      <div className="absolute -top-24 -left-24 w-[60vmin] h-[60vmin] rounded-full blur-3xl opacity-60" style={{background:"radial-gradient(circle at 30% 30%, rgba(124,58,237,.45), transparent 60%)"}} />
      <div className="absolute -bottom-24 -right-24 w-[70vmin] h-[70vmin] rounded-full blur-3xl opacity-60" style={{background:"radial-gradient(circle at 70% 70%, rgba(6,182,212,.45), transparent 60%)"}} />
      {/* subtle grid */}
      <div className="absolute inset-0 [mask-image:radial-gradient(circle_at_60%_40%,black_45%,transparent_80%)] opacity-[.10]" style={{
        backgroundImage: "linear-gradient(rgba(255,255,255,.16)_1px,transparent_1px),linear-gradient(90deg,rgba(255,255,255,.16)_1px,transparent_1px)",
        backgroundSize: "42px 42px"
      }} />
      {/* film grain */}
      <div className="absolute inset-0 opacity-10 mix-blend-overlay" style={{backgroundImage:"url('data:image/svg+xml;utf8,<svg xmlns=\'http://www.w3.org/2000/svg\' width=\'140\' height=\'140\'><filter id=\'n\'><feTurbulence type=\'fractalNoise\' baseFrequency=\'0.8\' numOctaves=\'4\' stitchTiles=\'stitch\'/></filter><rect width=\'100%\' height=\'100%\' filter=\'url(%23n)\' opacity=\'0.6\'/></svg>')"}} />
    </div>
  );
}

function Headshot() {
  const [src, setSrc] = useState("sirish.jpeg");
  const mouseX = useMotionValue(0);
  const mouseY = useMotionValue(0);
  const rotateX = useTransform(mouseY, [0, 1], [6, -6]);
  const rotateY = useTransform(mouseX, [0, 1], [-6, 6]);

  const onMove = (e: React.MouseEvent) => {
    const rect = (e.currentTarget as HTMLElement).getBoundingClientRect();
    mouseX.set((e.clientX - rect.left) / rect.width);
    mouseY.set((e.clientY - rect.top) / rect.height);
  };

  return (
    <motion.div
      onMouseMove={onMove}
      style={{ rotateX, rotateY, transformStyle: "preserve-3d" }}
      className="relative"
    >
      <div className="absolute -inset-2 rounded-[28px] bg-gradient-to-tr from-purple-500/25 via-fuchsia-400/20 to-cyan-400/25 blur-xl" />
      <img
        src={src}
        onError={() => setSrc("sirish.jpg")}
        alt="portrait of Sirish Yadav"
        className="relative z-10 w-[320px] md:w-[380px] h-auto rounded-[24px] object-cover shadow-[0_20px_60px_rgba(0,0,0,.45)] border border-white/10"
        style={{ transform: "translateZ(36px)" }}
      />
    </motion.div>
  );
}

export default function App() {
  const [contactOpen, setContactOpen] = useState(false);
  const year = new Date().getFullYear();

  const bounce = {
    initial: { opacity: 0, y: 14 },
    animate: { opacity: 1, y: 0, transition: { duration: 0.6 } },
  } as const;

  return (
    <div className="min-h-dvh bg-[#0b0d12] text-zinc-100 selection:bg-purple-500/30 selection:text-white">
      <Background />

      <main className="relative mx-auto max-w-6xl px-6 md:px-10 pt-10 pb-20">
        <header className="grid grid-cols-1 md:grid-cols-2 gap-10 items-center">
          <motion.div {...bounce}>
            <div className="inline-flex items-center gap-2 rounded-full border border-white/10 bg-white/5 px-3 py-1 text-[13px] text-zinc-300">
              <TerminalIcon size={16} className="opacity-80" />
              cloud and network engineer
            </div>
            <h1 className="mt-3 text-4xl md:text-5xl font-extrabold tracking-tight leading-tight">
              Sirish Yadav
            </h1>
            <p className="mt-3 text-zinc-300 max-w-prose">
              I make tech behave — Wi‑Fi that works, phones that ring, and logins that feel effortless. Networks, servers, PBX, cloud… if it connects or stores data, I make it faster, safer, and easier to use.
            </p>
            <p className="mt-2 text-zinc-300 max-w-prose">
              Firewalls, VLANs, VPNs, Azure, Entra ID — from building Azure systems and virtual networks to syncing on‑prem with the cloud, I keep everything running smoothly. If it needs automating, I automate it; if it needs building, I make it rock‑solid.
            </p>
            <p className="mt-2 text-zinc-300">I keep things simple, reliable, and worry‑free.</p>

            <div className="mt-5 flex flex-wrap items-center gap-3">
              <a
                href="Sirish-Yadav-Network%20and%20Systems%20Administrator.pdf"
                download
                className="inline-flex items-center gap-2 rounded-xl border border-white/10 bg-gradient-to-tr from-purple-500 to-cyan-400 text-[#0b0d12] font-extrabold px-4 py-3 shadow-[0_12px_40px_rgba(0,0,0,.3)] hover:translate-y-[-1px] transition-transform"
              >
                <Download size={18} />
                resume
              </a>

              <button
                onClick={() => setContactOpen((v) => !v)}
                className="inline-flex items-center gap-2 rounded-xl border border-white/10 bg-white/5 px-4 py-3 hover:bg-white/10 transition-colors"
              >
                contact me <ChevronRight size={16} className={`transition-transform ${contactOpen ? "rotate-90" : ""}`} />
              </button>
            </div>

            <motion.div
              initial={{ opacity: 0, y: -6 }}
              animate={{ opacity: contactOpen ? 1 : 0, y: contactOpen ? 0 : -6 }}
              className={`mt-3 overflow-hidden ${contactOpen ? "pointer-events-auto" : "pointer-events-none"}`}
            >
              <div className="divide-y divide-white/10 rounded-xl border border-white/10 bg-white/[.06] backdrop-blur">
                <a href="mailto:Sirish.chekutty@gmail.com" className="flex items-center gap-3 px-4 py-3 hover:bg-white/10">
                  <Mail size={18} />
                  Sirish.chekutty@gmail.com
                </a>
                <a href="https://www.linkedin.com/in/sirishchekutty/" target="_blank" rel="noreferrer" className="flex items-center gap-3 px-4 py-3 hover:bg-white/10">
                  <Linkedin size={18} />
                  linkedin.com/in/sirishchekutty
                </a>
                <a href="https://github.com/sirish-chekutty" target="_blank" rel="noreferrer" className="flex items-center gap-3 px-4 py-3 hover:bg-white/10">
                  <Github size={18} />
                  sirish-chekutty
                </a>
              </div>
            </motion.div>
          </motion.div>

          <motion.div {...bounce} className="justify-self-center md:justify-self-end">
            <Headshot />
          </motion.div>
        </header>

        <section className="mt-10 grid grid-cols-1 lg:grid-cols-3 gap-6 items-start">
          <motion.div {...bounce} className="lg:col-span-2">
            <TerminalLoop />
          </motion.div>

            <motion.div {...bounce} className="lg:col-span-1">
              <div className="rounded-2xl border border-white/10 bg-white/5 p-5 backdrop-blur shadow-xl">
                <h2 className="text-xl font-semibold">what I focus on</h2>
                <ul className="mt-3 space-y-2 text-zinc-300">
                  <li className="flex items-start gap-2"><span className="mt-1 h-2 w-2 rounded-full bg-emerald-400"/> azure, entra id, and hybrid identity</li>
                  <li className="flex items-start gap-2"><span className="mt-1 h-2 w-2 rounded-full bg-cyan-400"/> firewalls, vpn, and site networking</li>
                  <li className="flex items-start gap-2"><span className="mt-1 h-2 w-2 rounded-full bg-fuchsia-400"/> automation with powershell and python</li>
                  <li className="flex items-start gap-2"><span className="mt-1 h-2 w-2 rounded-full bg-purple-400"/> voip/pbx and qos that actually works</li>
                </ul>
              </div>
            </motion.div>
        </section>

        <footer className="mt-16 text-center text-sm text-zinc-400">
          © {year} Sirish Yadav
        </footer>
      </main>
    </div>
  );
}
